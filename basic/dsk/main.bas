0defusr=&h003B:a=usr(0):defusr1=&h003E:a=usr1(0):defusr2=&H90:a=usr2(0)
5defusr3=&H41:defusr4=&H44
10bload"xbasic.bin",r
20screen5,2,0:color15,1,1:open"grp:"as#1:definta-z
30 bload"sprites.bin",s:print #1,"Sprites leidos"
40 bload"scolor.bin",s:print #1,"colores sprites leidos"
50 bload"TILESET.S05",s,32768:print #1,"tileset leido"
60'bload"level0.bin",r:print#1,"TilemapcargadoenRAM"
70 print #1,"Cargando mapa":gosub 13000
100gosub10000
110strig(0)on:onstriggosub11100
2000gosub2500
2010gosub10100
2020gosub10200
2030ifmc=1thencls:gosub13100:gosub13300:ma=ma+1:mc=0:gosub8000
2040ifpb=0thenmc=1:ifma>1thenma=0
2080'gosub9000
2090goto2000
2500onstick(0)gosub2700,2500,2600,2500,2800,2500,2640
2520ifpa=1thenpy=py-pj
2530ifpa=1andpy<po-50thenpj=-pj
2540ifpa=1andpy>pothenpy=po:pj=0:pj=-pj:pa=0:strig(0)on
2599return
2600px=px+pv:ifpx>246thenpx=246
2610swapp(0),p(1):ps=p(1)
2630return
2640px=px-pv:ifpx<=0thenpx=0
2650swapp(2),p(3):ps=p(3)
2660return
2700ift0<>69andpa=0andt5=32thenpo=py:pj=8:pa=1:strig(0)offelsepy=py-pv
2710ifpy<=0thenpy=0
2750return
2800ift5=69thenpy=py+pv
2820ifpy>180thenpy=180
2850return
8000preset(0,184):print#1,"Score:"pr"Vidas:"pl"cogidas:"pb
8010preset(0,196):print#1,"Level:"ma"balas:"pg"libre:"fre(0)
8020return
9000'nada'
9010preset(0,0):print#1,"px"px"py"py"tx"tx"ty"ty
9020preset(0,8):print#1,"t0"t0"t1"t1"t3"t3"t5"t5"t7"t7
9090return
14000cls:preset(10,30):print#1,"Thehunter"
    14050 preset (10,160): print #1, "Cursores para mover, pulsa una tecla para continuar"
    14060 preset (10,180): print #1, "libre: "fre(0)
14070ifinkey$=""thengoto14070
14090return
20000'gosub12500:ex(en-1)=4*8:ey(en-1)=20*8
20030'gosub12500:ex(en-1)=26*8:ey(en-1)=20*8
20040pb=2
20090return
20100'gosub12500:ex(en-1)=4*8:ey(en-1)=20*8
20130'gosub12500:ex(en-1)=26*8:ey(en-1)=20*8
20140pb=2
20190return
10000px=3*8:py=17*8:pv=4:pj=0:po=py:pe=100:pa=0:pl=3:pr=0:pb=0:pg=100
10010dimp(6):p(0)=0:p(1)=1:p(2)=2:p(3)=3:p(4)=4:p(5)=5
10020pp=0:ps=0
10030putspritepp,(px,py),,ps
10090return
10100tx=(px+4)/8:ty=py/8
10120gosub13600
10125ift0=67thenbeep:copy(0,0)-(8,8),1to(px+4,py+8),0:m(ty+1,tx)=-1:pb=pb-1:gosub8000
10130ifpa=0andt5=255thenpy=py+pv
10140ifpa=1andt5=32thenpa=0:strig(0)on
10150ifpa=1andt1=32thenpy=py-pv
10195return
10200putspritepp,(px,py),,ps
10290return
13000tx=0:ty=0:t1=0:t3=0:t5=0:t7=0
13010dimm(22,32):ma=0:mc=1
13020dimt(5,5)
13030t(1,0)=32:t(1,1)=39
13040t(2,0)=69
13050t(3,0)=67:t(3,1)=98
13090return
13100'estoalmacenaráelarrayapartirdelaposición8dc8delaRAM'
13110ifma=0thenbload"level0.bin",r:gosub20000
13111ifma=1thenbload"level1.bin",r:gosub20100
13115callturboon(m())
13120md=&hd001
13130forf=0to22
13140forc=0to32-1
13150tn=peek(md):md=md+1
13160m(f,c)=tn
13170nextc
13180nextf
13190callturbooff
13195return
13300a=usr3(0):callturboon(m())
13310forf=0to22
13360forc=0to31
13370tn=m(f,c)
13380iftn>=0andtn<32thencopy(tn*8,0*8)-((tn*8)+8,(0*8)+8),1to(c*8,f*8),0,tpset
13390iftn>=32andtn<64thencopy((tn-32)*8,1*8)-(((tn-32)*8)+8,(1*8)+8),1to(c*8,f*8),0,tpset
13400iftn>=64andtn<96thencopy((tn-64)*8,2*8)-(((tn-64)*8)+8,(2*8)+8),1to(c*8,f*8),0,tpset
13410iftn>=96andtn<128thencopy((tn-96)*8,3*8)-(((tn-96)*8)+8,(3*8)+8),1to(c*8,f*8),0,tpset
13420iftn>=128andtn<160thencopy((tn-128)*8,4*8)-(((tn-128)*8)+8,(4*8)+8),1to(c*8,f*8),0,tpset
13430iftn>=160andtn<192thencopy((tn-160)*8,5*8)-(((tn-160)*8)+8,(5*8)+8),1to(c*8,f*8),0,tpset
13440iftn>=192andtn<224thencopy((tn-192)*8,6*8)-(((tn-192)*8)+8,(6*8)+8),1to(c*8,f*8),0,tpset
13450iftn>=224andtn<256thencopy((tn-224)*8,7*8)-(((tn-224)*8)+8,(7*8)+8),1to(c*8,f*8),0,tpset
13510nextc
13520nextf
13540a=usr4(0):callturbooff
13570return
13600t0=m(ty+1,tx)
13610t1=m(ty-1,tx)
13620t3=m(ty,tx+1)
13630t5=m(ty+2,tx)
13640iftx<=0thent7=m(ty,0)elset7=m(ty,tx-1)
13690return
11000dn=0:dd=0
11060return
11100ifdn>9thenreturn
11120dx(dn)=px+16:dy(dn)=py+8
11130dv(dn)=8
11140ds(dn)=6:dp(dn)=6+dn
11150da(dn)=0
11160dn=dn+1
11170beep
11180return
11200'BajamoselnúmerodedisparosparaquenospintelosXquehabíamosreservadoenelloader,sololosqueledecimos
11210dn=dn-1
11220'Ponemoselspritefueraparaquenosevea'
11230putspritedp(dd),(-16,0),15,ds(dd)
11240'preset(0,130):print#1,"D:ds:"ds(dd)",dp:"dp(dd)",dx:"dx(dd)
11250dx(dd)=dx(dn):dy(dd)=dy(dn):dv(dd)=dv(dn):ds(dd)=ds(dn):dp(dd)=dp(dn):da(dd)=da(dn)
11260return
11300ifdn=0thenreturn
11310fori=0todn-1
11320dx(i)=dx(i)+dv(i)
11330putspritedp(i),(dx(i),dy(i)),15,ds(i)
11340ifdx(i)>=256thendd=i:gosub11200
11350'preset(0,150+i*10):print#1,"i:"i",ds:"ds(i)",dp:"dp(i)
11360nexti
11390return
