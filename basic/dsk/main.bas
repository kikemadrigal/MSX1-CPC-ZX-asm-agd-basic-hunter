0defusr=&h003B:a=usr(0):defusr1=&h003E:a=usr1(0):defusr2=&H90:a=usr2(0)
5defusr3=&H41:defusr4=&H44
10bload"nbasic.bin",r
20open"grp:"as#1:definta-z
30 bload"sprites.bin",s:print #1,"Sprites leidos"
40 bload"scolor.bin",s:print #1,"colores sprites leidos"
50 bload"TILESET.S05",s,32768:print #1,"tileset leido"
70 print #1,"Cargando mapa":gosub 13000
80x=0:y=0
100gosub10000
105gosub11000
110strig(0)on:onstriggosub11100
120gosub12000
130'bload"music.bin":defusr5=&hC000:b=usr5(0):defusr6=&hC009:defusr7=&hC01A:b=usr7(0):defusr8=&hC013
140gosub14000
2000'nada'
2005gosub2500
2010gosub10100
2020gosub12700
2030gosub10200
2040'gosub11300
2050ifmc=1thencls:gosub13100:gosub13300:ma=ma+1:mc=0:gosub8000
2060ifpb=0thenmc=1:ifma>1thenma=0
2070'gosub9000
2090goto2000
2500onstick(0)gosub2600,2660,2700,2500,2800,2500,2860,2900
2599return
2600ifpa=0thenpo=py:pa=1
2650return
2660ifpa=0thenpo=py:pa=1
2670ift3<>twthenpx=px+pv:ifpx>246thenpx=246
2680swapp(0),p(1):ps=p(1)
2690return
2700ift3<>twthenpx=px+pv:ifpx>246thenpx=246
2710swapp(0),p(1):ps=p(1)
2720return
2800'ift5=69thenpy=py+pv
2850return
2860ift7<>twthenpx=px-pv:ifpx<=0thenpx=0
2870swapp(2),p(3):ps=p(3)
2890return
2900ifpa=0thenpo=py:pa=1
2910ift7<>twthenpx=px-pv:ifpx<=0thenpx=0
2920swapp(2),p(3):ps=p(3)
2950return
8000preset(0,184):print#1,"Score:"pr"Vidas:"pl"cogidas:"pb
8010preset(0,196):print#1,"Level:"ma"balas:"pg"libre:"fre(0)
8020return
9000'nada'
9010preset(0,16):print#1,"dn"dn"dx0"dx(0)"dy0"dy(0)"ds0"ds(0)"dp0"dp(0)
9090return
14000cls:preset(10,30):print#1,"Thehunter"
    14050 preset (10,160): print #1, "Cursores para mover, pulsa una tecla para continuar"
    14060 preset (10,180): print #1, "libre: "fre(0)
14070'b=usr6(0)
14080ifinkey$=""thengoto14070
14085'b=usr8(0)
14090return
14100en=0
14110cls:preset(10,30):print#1,"Gameover"
14120py=212
14130mc=1:ma=0
14140fori=0to1000:nexti
14150goto130
14190return
20000en=0
20010gosub12500:ex(en-1)=14*8:ey(en-1)=14*8:es(en-1)=17
20030gosub12500:ex(en-1)=26*8:ey(en-1)=4*8
20040pb=8
20050px=3*8:py=18*8
20090return
20100en=0
20140pb=6
20150px=3*8:py=18*8
20190return
10000px=3*8:py=18*8:pv=8:pw=8:pj=0:po=py:pe=100:pa=0:pl=3:pr=0:pb=0:pg=100
10010p(0)=0:p(1)=1:p(2)=2:p(3)=3:p(4)=4:p(5)=5
10020pp=0:ps=0
10090return
10100x=px:y=py:gosub13600
10110ifpa=1thenpy=py-pw
10111ift1=twthenpa=2
10120ifpa=1andpy<po-48thenpa=2
10135ift5=twandpa=2thenpa=0
10136ifpa=2thenpy=py+pw
10140ifpy>170thenpy=170
10150ifpy<=0thenpy=0
10168ift0=tcthencopy(8,40)-(8+8,39+8),1to(px,py+8),0:m(ty+1,tx)=-1:beep:pb=pb-1:gosub8000
10170ifpa=0andt5<>twthenpy=py+pv
10195return
10200putspritepp,(px,py),,ps
10290return
10300ifpl<=0thengosub14100elsebeep:pl=pl-1:gosub8000:px=3*8:py=18*8
10390return
11000dn=0:dd=0:dm=3
11010DIMdx(dm),dy(dm),dv(dm),dw(dm),dd(dm),ds(dm),dp(dm),da(dm)
11060return
11100ifdn>9thenreturn
11120dx(dn)=px+16:dy(dn)=py+8
11130dv(dn)=8
11140ds(dn)=12:dp(dn)=2+dn
11150da(dn)=0
11160dn=dn+1
11170beep
11180return
11200'BajamoselnúmerodedisparosparaquenospintelosXquehabíamosreservadoenelloader,sololosqueledecimos
11210dn=dn-1
11220'Ponemoselspritefueraparaquenosevea'
11230putspritedp(dd),(-16,0),15,ds(dd)
11240'preset(0,130):print#1,"D:ds:"ds(dd)",dp:"dp(dd)",dx:"dx(dd)
11250dx(dd)=dx(dn):dy(dd)=dy(dn):dv(dd)=dv(dn):ds(dd)=ds(dn):dp(dd)=dp(dn):da(dd)=da(dn)
11260return
11300ifdn<=0thenreturn
11310fori=0todn-1
11320dx(i)=dx(i)+dv(i)
11330putspritedp(i),(dx(i),dy(i)),15,ds(i)
11340ifdx(i)>=256thendd=i:gosub11200
11350'preset(0,150+i*10):print#1,"i:"i",ds:"ds(i)",dp:"dp(i)
11360nexti
11390return
12000em=3
12010en=0
12020DIMex(em),ey(em),ev(em),ew(em),ed(em),es(em),ep(em),ec(em),et(em),ee(em)
12030return
12500ifen>5thenreturn
12530ev(en)=8:ew(en)=8
12540ed(en)=3
12550es(en)=13
12560ep(en)=10+en
12570ec(en)=6
12580en=en+1
12590return
12700ifen<=0thenreturn
12710fori=0toen-1
12720ifed(i)=3thenx=ex(i)+8:ifed(i)=7thenx=ex(i)-8
12730y=ey(i):gosub13600
12740ift5<>twthenev(i)=-ev(i)
12750ex(i)=ex(i)-ev(i):ifex(i)>256-40thenex(i)=ex(i)-ev(i):ifex(i)<0thenex(i)=ex(i)-ev(i)
12760ifex(i)<px+16andex(i)+16>pxandey(i)<py+16and16+ey(i)>pythengosub10300
12770putspriteep(i),(ex(i),ey(i)),ec(i),es(i)
12800nexti
12810return
13000tx=0:ty=0:t0=0:t1=0:t3=0:t5=0:t7=0
13005te=255:tw=32:tl=0:tf=0:td=0:tc=67
13010dimm(22,32):ma=0:mc=1
13090return
    13100 'print #1, "cargando mapa"
13110ifma=0thenbload"level0.bin",r:gosub20000
13111ifma=1thenbload"level1.bin",r:gosub20100
13115callturboon(m())
13120md=&hd001
13130forf=0to22
13140forc=0to32-1
13150tn=peek(md):md=md+1
13160m(f,c)=tn
13170nextc
13180nextf
13190callturbooff
13195return
13300a=usr3(0)
13301callturboon(m())
13310forf=0to22
13360forc=0to31
13370tn=m(f,c)
13380iftn>=0andtn<32thencopy(tn*8,0*8)-((tn*8)+8,(0*8)+8),1to(c*8,f*8),0,tpset
13390iftn>=32andtn<64thencopy((tn-32)*8,1*8)-(((tn-32)*8)+8,(1*8)+8),1to(c*8,f*8),0,tpset
13400iftn>=64andtn<96thencopy((tn-64)*8,2*8)-(((tn-64)*8)+8,(2*8)+8),1to(c*8,f*8),0,tpset
13410iftn>=96andtn<128thencopy((tn-96)*8,3*8)-(((tn-96)*8)+8,(3*8)+8),1to(c*8,f*8),0,tpset
13420iftn>=128andtn<160thencopy((tn-128)*8,4*8)-(((tn-128)*8)+8,(4*8)+8),1to(c*8,f*8),0,tpset
13430iftn>=160andtn<192thencopy((tn-160)*8,5*8)-(((tn-160)*8)+8,(5*8)+8),1to(c*8,f*8),0,tpset
13440iftn>=192andtn<224thencopy((tn-192)*8,6*8)-(((tn-192)*8)+8,(6*8)+8),1to(c*8,f*8),0,tpset
13450iftn>=224andtn<256thencopy((tn-224)*8,7*8)-(((tn-224)*8)+8,(7*8)+8),1to(c*8,f*8),0,tpset
13510nextc
13520nextf
13540a=usr4(0):
13541callturbooff
13570return
13600tx=x/8:ty=y/8
13605ifty>0thent0=m(ty+1,tx)
13610t1=m(ty-1,tx)
13620ifty>256-16thent3=m(ty,tx+1)
13630ifty>0andty<20thent5=m(ty+2,tx)
13640iftx>0thent7=m(ty,tx-1)
13690return
